# 操作系统

![image-20251217120708504](操作系统.assets/image-20251217120708504.png)

## 引言

### 操作系统的基本特征：并发，共享，虚拟，异步



#### 并发与并行的辨析：

并发是两个或多个事件在==同一时间间隔内==发生，实质是“宏观上都在运行，微观上交替执行”，而并行是两个或多个事件在==同一时刻==发生，实质是“多核CPU运行多道程序，同时执行，互不干扰”

并发 ——> 单核CPU，并行 ——> 多核CPU



#### 共享（针对系统资源来说的）

目的：使得系统中的资源，供内存中多个==并发执行==的进程共同使用

分为：互斥共享 和 同时访问

系统中某些资源，需要互斥共享（规定在一段时间内，只允许一个进程访问该资源），比如打印机，摄像头；而有些资源，允许一段时间内多个进程同时对他们进行访问（宏观上同时执行）（微观上不确定是交替还是同时），比如磁盘读取文件，扬声器。



#### 互斥共享 和 同时访问 的区别：

互斥共享：独占使用。（当资源被进程A占用时，进程B想用？没门！只能阻塞，直到A用完释放）

同时访问：允许并发，多方共用。（进程A在用，进程B也可以用。大家不用严格排队等对方彻底结束）



#### 虚拟

分为两种技术：时分复用，空分复用

时分复用：你只有一个单核CPU，但系统里开了100个进程，利用时间轮转法，让多个程序并发执行，每个进程都以为自己独占一个CPU。

空分复用：你物理内存只有8G，但你可以玩50G的游戏。实质是：操作系统在背后将数据在内存和外存之间来回倒腾（“缺页中断”和“置换算法”），让你以为内存无限大。



#### 异步 

在并发环境中，进程的执行不是一气呵成的，而是走走停停。

如果不加以管理，这会导致：同样的程序每一次的结果不同（结果不可再现性）。因此，我们需要进程同步机制（信号量，锁）。



## 进程

### 进程同步

假设你和你的伴侣共用一张银行卡，里面有1000块。

1. 你走到ATM机，读出余额：1000。准备取100。（此时CPU切换了！）
2. 伴侣在手机APP上，读出余额：1000。准备存100。
3. 伴侣的操作先完成：1000+100=11001000+100=1100。写入数据库。
4. 你的操作接着完成（你手里拿的数据还是旧的1000）：1000−100=9001000−100=900。写入数据库。

结果：数据库变成了900。伴侣存的那100块凭空消失了！

因此：如果不加控制，并发进程对共享数据（临界资源）的乱序访问，会导致数据不一致。所以我们需要“同步”。



**同步机制必须遵循的四条准则：**

- 空闲让进（没人用你就进）；
- 忙则等待（有人用你就等）；
- 有限等待（不能一直等）；
- 让权等待（等待的过程中，先把CPU让出，不能占着茅坑不拉屎）；



先来了解一下几个概念：

临界资源：一次只允许一个进程使用的资源

临界区：程序中访问临界资源的那段代码

信号量（分为：整型信号量，记录型信号量）：可用资源数量（负值表示：无可用资源，且存在资源请求）

原语：特殊的程序段，如果选择执行，则必须完全执行，不可中断

P操作（wait原语）：申请资源（进入区）

V操作（signal原语）：释放资源（退出区）





### 信号量机制





### 经典模型：生产者-消费者问题

有两个进程A和B，它们共享一个固定大小的缓冲区，A进程产生数据放入缓冲区，B进程从缓冲区中取出数据进行计算，那么这里其实就是一个生产者和消费者的模式，A相当于生产者，B相当于消费者。

要求：

- 只有缓冲区没满时，生产者才能把产品放入缓冲区，否则必须等待。
- 只有缓冲区不空时，消费者才能从中取出产品，否则必须等待。
- 缓冲区是临界资源，各进程必须互斥地访问。



